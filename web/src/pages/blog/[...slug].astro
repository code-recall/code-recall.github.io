---
import Tags from '@/components/Tags.astro'
import BaseLayout from '@/layouts/BaseLayout.astro'
import BlogPostLayout from '@/layouts/BlogPostLayout.astro'
import type { GetStaticPaths, InferGetStaticPropsType } from 'astro'
import { getCollection } from 'astro:content'

export const getStaticPaths = (async () => {
  const posts = await getCollection('blog')

  return posts.map((post) => ({
    params: { slug: post.slug.split('/').at(1) },
    props: { post },
  }))
}) satisfies GetStaticPaths

type Props = InferGetStaticPropsType<typeof getStaticPaths>

const { post } = Astro.props
const { Content } = await post.render()
const pubDate = post.data.pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
})
---

<BaseLayout title={post.data.title} description={post.data.description}>
  <div class="mb-6">
    <h1>{post.data.title}</h1>
    <div class="flex items-center justify-between">
      <div class="inline-flex items-center gap-2 text-sm">
        <p class="font-semibold">{post.data.author}</p>
        <time class="text-gray-500">{pubDate}</time>
      </div>
      <Tags links={true} tags={post.data.tags} />
    </div>

    <p>{post.data.description}</p>
  </div>

  <BlogPostLayout>
    <Content />
  </BlogPostLayout>
</BaseLayout>
